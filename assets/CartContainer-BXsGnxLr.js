import{r as m,T as k,$ as A,a0 as B,L as C,d as r,a as s,b,P,X as N,x,a1 as F,a2 as M,a3 as Q,E as c,p as q,Z as L,Y as R,o as V,e as p,a4 as Y,_ as G,a5 as H,n as X}from"./index-BB3_t5sF.js";/* empty css                  *//* empty css                   *//* empty css                 *//* empty css               *//* empty css                    *//* empty css                  *//* empty css                     *//* empty css                  */import{u as Z}from"./cart-C1uTJAab.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={key:0},J={class:"box"},K={__name:"CartContainer",setup(W){const u=Z(),n=m([{}]),f=m([{UserID:"",OrderDate:"",TotalAmount:0,OrderID:"",ProductID:"",Quantity:"",OrderStatus:""}]),i=m(!1),I=m(""),g=m(!1);k(()=>{n.value=[...u.cartItems]}),A(()=>{u.saveCartToLocalStorage()});const w=e=>{n.value=n.value.filter(t=>t.ProductID!==e),u.removeFromCart(e),c.success("从购物车删除商品成功")},E=(e,t)=>{if(t>0){const a=n.value.findIndex(l=>l.ProductID===e);a!==-1&&(n.value[a].quantity=t,u.updateProductQuantity({ProductID:e,Quantity:t}),c.success("更新商品数量成功"))}},S=B(()=>u.cartTotal);function T(e){const t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),l=e.getDate().toString().padStart(2,"0"),d=e.getHours().toString().padStart(2,"0"),_=e.getMinutes().toString().padStart(2,"0"),D=e.getSeconds().toString().padStart(2,"0");return`${t}-${a}-${l} ${d}:${_}:${D}`}const h=T(new Date),O=async()=>{(await x(localStorage.getItem("res"))).data.data.data[0].Address?g.value||y():F({title:"地址信息缺失",message:"请填写您的收货地址信息！",showCancelButton:!0,confirmButtonText:"去填写",cancelButtonText:"取消"}).then(()=>{i.value=!0}).catch(()=>{})},y=async()=>{f.value.UserID=localStorage.getItem("res"),f.value.OrderDate=h,f.value.TotalAmount=S.value;try{const e=await M(f.value);if(e.data.data.data.OrderID){const t=e.data.data.data.OrderID,a=n.value.map(l=>({OrderID:t,ProductID:l.ProductID,Quantity:l.quantity,UserID:localStorage.getItem("res")}));await Q(a),c.success("结算成功"),u.clearCart(),location.reload(),localStorage.removeItem("cartItems"),g.value=!0}else throw new Error("订单创建失败")}catch{c.error("结算失败")}},U=async()=>{try{const a={...(await x(localStorage.getItem("res"))).data.data.data[0],Address:I.value,UserID:localStorage.getItem("res")};await Y(a),c.success("用户信息更新成功"),i.value=!1,g.value||y()}catch{c.error("用户信息更新失败")}};return(e,t)=>{const a=G,l=H,d=q,_=L,D=X,$=R;return V(),C("div",null,[r(_,{data:n.value,style:{width:"100%"},height:"250"},{default:s(()=>[r(a,{prop:"ProductName",label:"商品名"}),r(a,{label:"数量"},{default:s(({row:o})=>[r(l,{modelValue:o.quantity,"onUpdate:modelValue":v=>o.quantity=v,min:1,onChange:v=>E(o.ProductID,v)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),r(a,{prop:"Price",label:"单价"}),r(a,{label:"总价"},{default:s(({row:o})=>[p(" ￥"+P((o.Price*o.quantity).toFixed(2)),1)]),_:1}),r(a,{label:"操作"},{default:s(({row:o})=>[r(d,{type:"danger",onClick:v=>w(o.ProductID)},{default:s(()=>t[3]||(t[3]=[p("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),n.value.length?(V(),C("div",z,[b("h3",null,"总价格为: ￥"+P(S.value),1),r(d,{type:"primary",onClick:O},{default:s(()=>t[4]||(t[4]=[p("结算")])),_:1})])):N("",!0),r($,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=o=>i.value=o)},{default:s(()=>[b("div",J,[r(D,{modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=o=>I.value=o),style:{width:"240px"},placeholder:"请输入地址"},null,8,["modelValue"]),r(d,{type:"primary",plain:"",onClick:t[1]||(t[1]=o=>i.value=!1)},{default:s(()=>t[5]||(t[5]=[p("返回")])),_:1}),r(d,{type:"success",plain:"",onClick:U},{default:s(()=>t[6]||(t[6]=[p("提交")])),_:1})])]),_:1},8,["modelValue"])])}}},mt=j(K,[["__scopeId","data-v-8a147a3b"]]);export{mt as default};
