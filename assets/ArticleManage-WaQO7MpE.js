import{r as m,o as _,c as V,a as o,L as R,M as H,N as Z,V as J,ax as M,ay as T,F as K,d as t,f as S,a7 as Q,b as W,e as g,E as z,az as X,U as h,n as ee,m as A,S as te,aa as ae,p as j,s as F,aA as le,aB as oe,ak as ne,P as B,aC as re,aD as se,a1 as ue,q as ie,_ as de,Z as ce,aE as pe,al as me}from"./index-BB3_t5sF.js";/* empty css                   */import{_ as _e}from"./PageContainer-Cl73poUb.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                *//* empty css                     *//* empty css                  */import{a as ve,b as fe,c as ge,d as ye,e as be,f as Ce}from"./article-oSFKJoHP.js";/* empty css                   *//* empty css                    *//* empty css                   */import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                       *//* empty css                */const $={__name:"ChannelSelect",props:{modelValue:{type:[Number,String]},width:{type:String}},emits:["update:modelValue"],setup(y,{emit:b}){const v=b,d=m([]);return(async()=>{const l=await ve();d.value=l.data.data.data})(),(l,c)=>{const k=M,C=T;return _(),V(C,{modelValue:y.modelValue,"onUpdate:modelValue":c[0]||(c[0]=p=>v("update:modelValue",p)),style:J({width:y.width})},{default:o(()=>[(_(!0),R(H,null,Z(d.value,p=>(_(),V(k,{key:p.CategoryID,label:p.CategoryName,value:p.CategoryID},null,8,["label","value"]))),128))]),_:1},8,["modelValue","style"])}}},Ve=["src"],ke={class:"editor"},Ee={__name:"ArticleEdit",emits:["success"],setup(y,{expose:b,emit:v}){const d=m(!1),n={ProductName:"",CategoryID:"",Image:"",Description:"",state:"",Price:"",Stock:"",CategoryName:"",category:""},l=m({...n}),c=m(""),k=r=>{r&&r.raw&&(c.value=URL.createObjectURL(r.raw),l.value.Image=r.raw)},C=v,p=async r=>{l.value.state=r;const e=new FormData;for(let a in l.value)e.append(a,l.value[a]);l.value.ProductID?(await fe(e),z.success("修改成功"),d.value=!1,C("success","edit")):(await ge(e),z.success("添加成功"),d.value=!1,C("success","add"))},D=m(),P=async r=>{if(d.value=!0,r!=null&&r.ProductID){const e=await ye(r.ProductID);if(e&&e.data&&e.data.data&&e.data.data.data){l.value={...e.data.data.data},c.value=X+e.data.data.data.Image;const a=await x(c.value,e.data.data.data.Image);l.value.Image=a}else console.error("获取详情数据失败:",e)}else l.value={...n},c.value="",D.value.setHTML("")};async function x(r,e){try{const a=await h.get(r,{responseType:"arraybuffer"});if(!a.data)throw new Error("No data received from the URL");const s=new Blob([a.data],{type:a.headers["content-type"]||"image/jpeg"});return new File([s],e,{type:a.headers["content-type"]||"image/jpeg"})}catch(a){return console.error("Error converting image URL to File object:",a),null}}function U(){const r=l.value.Description,a=new DOMParser().parseFromString(r,"text/html");l.value.Description=a.body.textContent||""}return b({open:P}),(r,e)=>{const a=ee,s=A,E=te,w=ae,N=K("quill-editor"),I=j,L=F,f=le;return _(),V(f,{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=u=>d.value=u),ProcuctName:l.value.ProductID?"编辑产品":"添加产品",direction:"rtl",size:"50%"},{default:o(()=>[t(L,{model:l.value,ref:"formRef","label-width":"100px"},{default:o(()=>[t(s,{label:"产品名称",prop:"ProductName"},{default:o(()=>[t(a,{modelValue:l.value.ProductName,"onUpdate:modelValue":e[0]||(e[0]=u=>l.value.ProductName=u),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(s,{label:"产品价格",prop:"Price"},{default:o(()=>[t(a,{modelValue:l.value.Price,"onUpdate:modelValue":e[1]||(e[1]=u=>l.value.Price=u),placeholder:"请输入价钱"},null,8,["modelValue"])]),_:1}),t(s,{label:"产品库存",prop:"Stock"},{default:o(()=>[t(a,{modelValue:l.value.Stock,"onUpdate:modelValue":e[2]||(e[2]=u=>l.value.Stock=u),placeholder:"请输入库存"},null,8,["modelValue"])]),_:1}),t(s,{label:"产品分类",prop:"CategoryID"},{default:o(()=>[t($,{modelValue:l.value.CategoryID,"onUpdate:modelValue":e[3]||(e[3]=u=>l.value.CategoryID=u),width:"100%"},null,8,["modelValue"])]),_:1}),t(s,{label:"产品封面",prop:"Image"},{default:o(()=>[t(w,{class:"avatar-uploader","show-file-list":!1,"auto-upload":!1,"on-change":k},{default:o(()=>[c.value?(_(),R("img",{key:0,src:c.value,class:"avatar"},null,8,Ve)):(_(),V(E,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[t(S(Q))]),_:1}))]),_:1})]),_:1}),t(s,{label:"产品内容",prop:"Description"},{default:o(()=>[W("div",ke,[t(N,{ref_key:"editorRef",ref:D,content:l.value.Description,"onUpdate:content":e[4]||(e[4]=u=>l.value.Description=u),"content-type":"text",theme:"snow",onBlur:U},null,8,["content"])])]),_:1}),t(s,null,{default:o(()=>[t(I,{onClick:e[5]||(e[5]=u=>p("已发布")),type:"primary"},{default:o(()=>e[8]||(e[8]=[g("发布")])),_:1}),t(I,{onClick:e[6]||(e[6]=u=>p("草稿")),type:"info"},{default:o(()=>e[9]||(e[9]=[g("草稿")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","ProcuctName"])}}},we=De(Ee,[["__scopeId","data-v-94b8d7e2"]]),Ie=y=>oe(y).format("YYYY年MM月DD日"),He={__name:"ArticleManage",setup(y){const b=m([]),v=m(0),d=m(!1),n=m({pagenum:1,pagesize:5,CategoryID:1,CategoryName:"",state:"",category:""}),l=async()=>{d.value=!0;const e=await be(n.value);b.value=e.data.data.data,v.value=e.data.data.total,d.value=!1};l();const c=e=>{n.value.pagenum=1,n.value.pagesize=e,l()},k=e=>{n.value.pagenum=e,l()},C=()=>{n.value.pagenum=1,l()},p=()=>{n.value.pagenum=1,n.value.CategoryID="",n.value.state="",l()},D=m(),P=()=>{D.value.open({})},x=e=>{D.value.open(e)},U=async e=>{await ue.confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ce(e.ProductID),z.success("删除成功"),l()},r=e=>{if(e==="add"){const a=Math.ceil((v.value+1)/n.value.pagesize);n.value.pagenum=a}l()};return(e,a)=>{const s=j,E=A,w=M,N=T,I=F,L=ie,f=de,u=ce,O=pe,Y=_e,q=me;return _(),V(Y,{title:"产品管理"},{extra:o(()=>[t(s,{type:"primary",onClick:P},{default:o(()=>a[4]||(a[4]=[g("添加产品")])),_:1})]),default:o(()=>[t(I,{inline:""},{default:o(()=>[t(E,{label:"产品分类:"},{default:o(()=>[t($,{modelValue:n.value.CategoryID,"onUpdate:modelValue":a[0]||(a[0]=i=>n.value.CategoryID=i)},null,8,["modelValue"])]),_:1}),t(E,{label:"发布状态:"},{default:o(()=>[t(N,{modelValue:n.value.state,"onUpdate:modelValue":a[1]||(a[1]=i=>n.value.state=i)},{default:o(()=>[t(w,{label:"已发布",value:"已发布"}),t(w,{label:"草稿",value:"草稿"})]),_:1},8,["modelValue"])]),_:1}),t(E,null,{default:o(()=>[t(s,{onClick:C,type:"primary"},{default:o(()=>a[5]||(a[5]=[g("搜索")])),_:1}),t(s,{onClick:p},{default:o(()=>a[6]||(a[6]=[g("重置")])),_:1})]),_:1})]),_:1}),ne((_(),V(u,{data:b.value},{default:o(()=>[t(f,{label:"产品标题",prop:"ProductName"},{default:o(({row:i})=>[t(L,{type:"primary",underline:!1},{default:o(()=>[g(B(i.ProductName),1)]),_:2},1024)]),_:1}),t(f,{label:"分类",prop:"category.CategoryName"}),t(f,{label:"发表时间",prop:"pub_date"},{default:o(({row:i})=>[g(B(S(Ie)(i.pub_date)),1)]),_:1}),t(f,{label:"状态",prop:"state"}),t(f,{label:"操作"},{default:o(({row:i})=>[t(s,{circle:"",plain:"",type:"primary",icon:S(re),onClick:G=>x(i)},null,8,["icon","onClick"]),t(s,{circle:"",plain:"",type:"danger",icon:S(se),onClick:G=>U(i)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[q,d.value]]),t(O,{"current-page":n.value.pagenum,"onUpdate:currentPage":a[2]||(a[2]=i=>n.value.pagenum=i),"page-size":n.value.pagesize,"onUpdate:pageSize":a[3]||(a[3]=i=>n.value.pagesize=i),"page-sizes":[2,3,5,10],background:!0,layout:"jumper, total, sizes, prev, pager, next",total:v.value,onSizeChange:c,onCurrentChange:k,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"]),t(we,{ref_key:"articleEditRef",ref:D,onSuccess:r},null,512)]),_:1})}}};export{He as default};
